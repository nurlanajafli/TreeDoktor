"use strict";(self.webpackChunkportal=self.webpackChunkportal||[]).push([[453],{7989:(D,w,p)=>{p(639),p(4943);var e=p(639),r=p(4943),v=function(){function t(){}return t.ctorParameters=[],t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[[]]}),t}();w.j=v,w.u=r.SignaturePad},4943:(D,w,p)=>{var g=p(639),y=p(639),e=function(){function r(v){this.elementRef=v,this.options=this.options||{},this.onBeginEvent=new g.EventEmitter,this.onEndEvent=new g.EventEmitter}return r.prototype.ngAfterContentInit=function(){var v=p(5885).Z,t=this.elementRef.nativeElement.querySelector("canvas");this.options.canvasHeight&&(t.height=this.options.canvasHeight),this.options.canvasWidth&&(t.width=this.options.canvasWidth),this.signaturePad=new v(t,this.options),this.signaturePad.onBegin=this.onBegin.bind(this),this.signaturePad.onEnd=this.onEnd.bind(this)},r.prototype.ngOnDestroy=function(){var v=this.elementRef.nativeElement.querySelector("canvas");v.width=0,v.height=0},r.prototype.resizeCanvas=function(){var v=Math.max(window.devicePixelRatio||1,1),t=this.signaturePad._canvas;t.width=t.offsetWidth*v,t.height=t.offsetHeight*v,t.getContext("2d").scale(v,v),this.signaturePad.clear()},r.prototype.toData=function(){return this.signaturePad?this.signaturePad.toData():[]},r.prototype.fromData=function(v){this.signaturePad.fromData(v)},r.prototype.toDataURL=function(v,t){return this.signaturePad.toDataURL(v,t)},r.prototype.fromDataURL=function(v,t){void 0===t&&(t={}),!t.hasOwnProperty("height")&&this.options.canvasHeight&&(t.height=this.options.canvasHeight),!t.hasOwnProperty("width")&&this.options.canvasWidth&&(t.width=this.options.canvasWidth),this.signaturePad.fromDataURL(v,t)},r.prototype.clear=function(){this.signaturePad.clear()},r.prototype.isEmpty=function(){return this.signaturePad.isEmpty()},r.prototype.off=function(){this.signaturePad.off()},r.prototype.on=function(){this.signaturePad.on()},r.prototype.set=function(v,t){switch(v){case"canvasHeight":this.signaturePad._canvas.height=t;break;case"canvasWidth":this.signaturePad._canvas.width=t;break;default:this.signaturePad[v]=t}},r.prototype.onBegin=function(){this.onBeginEvent.emit(!0)},r.prototype.onEnd=function(){this.onEndEvent.emit(!0)},r.prototype.queryPad=function(){return this.signaturePad},r.ctorParameters=[{type:g.ElementRef}],r.propDecorators={options:[{type:g.Input}],onBeginEvent:[{type:g.Output}],onEndEvent:[{type:g.Output}]},r.\u0275fac=function(t){return new(t||r)(y.\u0275\u0275directiveInject(y.ElementRef))},r.\u0275cmp=y.\u0275\u0275defineComponent({type:r,selectors:[["signature-pad"]],inputs:{options:"options"},outputs:{onBeginEvent:"onBeginEvent",onEndEvent:"onEndEvent"},decls:1,vars:0,template:function(t,n){1&t&&y.\u0275\u0275element(0,"canvas")},encapsulation:2}),r}();w.SignaturePad=e},3453:(D,w,p)=>{p.r(w),p.d(w,{SignModule:()=>d});var g=p(8583),y=p(7989),e=p(639),r=p(8320),v=p(9441),t=p(2498),n=p(665);const i=["sigContainer1"],o=[{path:"",component:(()=>{class h{constructor(l,s,u){this.modal=l,this.ps=s,this.router=u,this.signature=!0,this.signaturePadOptions={canvasHeight:300}}ngOnInit(){this.signaturePad?this.size():setTimeout(this.ngOnInit.bind(this),100)}undoSign(){this.data=this.signaturePad.toData(),this.data&&(this.data.pop(),this.signaturePad.fromData(this.data),this.dataUrl=this.data.length?this.signaturePad.toDataURL():"")}clearSign(){this.signaturePad&&(this.signaturePad.clear(),this.data=this.signaturePad.toData(),this.dataUrl="")}drawComplete(){this.dataUrl=this.signaturePad.toDataURL(),this.data=this.signaturePad.toData()}size(){this.sigContainer1&&this.sigContainer1.first?(this.signaturePad.set("canvasWidth",this.sigContainer1.first.elementRef.nativeElement.parentElement.clientWidth),this.clearSign()):setTimeout(()=>{this.size()},100)}}return h.\u0275fac=function(l){return new(l||h)(e.\u0275\u0275directiveInject(r.Z7),e.\u0275\u0275directiveInject(v.E),e.\u0275\u0275directiveInject(t.F0))},h.\u0275cmp=e.\u0275\u0275defineComponent({type:h,selectors:[["app-sign"]],viewQuery:function(l,s){if(1&l&&(e.\u0275\u0275viewQuery(y.u,5),e.\u0275\u0275viewQuery(i,5)),2&l){let u;e.\u0275\u0275queryRefresh(u=e.\u0275\u0275loadQuery())&&(s.signaturePad=u.first),e.\u0275\u0275queryRefresh(u=e.\u0275\u0275loadQuery())&&(s.sigContainer1=u)}},decls:36,vars:7,consts:[[1,"head-est"],[1,"mr10"],[1,"sign-box"],[1,"sign-head"],[1,"sign-btns"],["title","Undo changes",1,"mico","mr20",3,"click"],["title","Clear all",1,"mico","cl-red",3,"click"],[2,"background-color","#F1F3F7"],[3,"options","resize","onEndEvent"],["sigContainer1",""],[1,"mb30"],["rows","3","placeholder","Type your comment...",1,"input",3,"ngModel","ngModelChange"],[1,"terms-row"],[1,"check-lebel"],["type","checkbox","name","terms","id","termCheck",3,"ngModel","ngModelChange"],[1,"checkbox"],["for","termCheck",1,"mr5"],[1,"mr5","link",3,"click"],[1,"ta-c"],[1,"btn",3,"disabled","click"],[1,"link-back",3,"routerLink"],[1,"link"]],template:function(l,s){1&l&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275elementStart(1,"span",1),e.\u0275\u0275text(2,"Estimate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",2),e.\u0275\u0275elementStart(6,"div",3),e.\u0275\u0275elementStart(7,"h3"),e.\u0275\u0275text(8,"Sign here:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",4),e.\u0275\u0275elementStart(10,"i",5),e.\u0275\u0275listener("click",function(){return s.undoSign()}),e.\u0275\u0275text(11,"undo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"i",6),e.\u0275\u0275listener("click",function(){return s.clearSign()}),e.\u0275\u0275text(13,"clear"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"div",7),e.\u0275\u0275elementStart(15,"signature-pad",8,9),e.\u0275\u0275listener("resize",function(){return s.size()},!1,e.\u0275\u0275resolveWindow)("onEndEvent",function(){return s.drawComplete()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",10),e.\u0275\u0275elementStart(18,"h3"),e.\u0275\u0275text(19,"Confirmation note:"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"textarea",11),e.\u0275\u0275listener("ngModelChange",function(m){return s.note=m}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",12),e.\u0275\u0275elementStart(22,"label",13),e.\u0275\u0275elementStart(23,"input",14),e.\u0275\u0275listener("ngModelChange",function(m){return s.accept=m}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"span",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div"),e.\u0275\u0275elementStart(26,"label",16),e.\u0275\u0275text(27,"I accept"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"span",17),e.\u0275\u0275listener("click",function(m){return m.stopPropagation(),s.modal.show({component:"terms"})}),e.\u0275\u0275text(29,"terms and conditions"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"div",18),e.\u0275\u0275elementStart(31,"button",19),e.\u0275\u0275listener("click",function(){return s.ps.sendSignature(s.dataUrl,s.note)}),e.\u0275\u0275text(32,"Apply signature"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"div",20),e.\u0275\u0275elementStart(34,"a",21),e.\u0275\u0275text(35,"back to estimate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementEnd()),2&l&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate2("#",s.ps.estimate.estimate_no," Rev. ",s.ps.estimate.estimate_review_number,""),e.\u0275\u0275advance(11),e.\u0275\u0275property("options",s.signaturePadOptions),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngModel",s.note),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngModel",s.accept),e.\u0275\u0275advance(8),e.\u0275\u0275property("disabled",!s.dataUrl||!s.accept),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate1("routerLink","/",s.ps.token,""))},directives:[y.u,n.Fj,n.JJ,n.On,n.Wl,t.rH],styles:[""]}),h})()}];let d=(()=>{class h{}return h.\u0275fac=function(l){return new(l||h)},h.\u0275mod=e.\u0275\u0275defineNgModule({type:h}),h.\u0275inj=e.\u0275\u0275defineInjector({imports:[[t.Bz.forChild(o),y.j,g.ez,n.u5]]}),h})()},5885:(D,w,p)=>{function g(t,n,i){this.x=t,this.y=n,this.time=i||(new Date).getTime()}function y(t,n,i,a){this.startPoint=t,this.control1=n,this.control2=i,this.endPoint=a}function r(t,n){var i=this,a=n||{};this.velocityFilterWeight=a.velocityFilterWeight||.7,this.minWidth=a.minWidth||.5,this.maxWidth=a.maxWidth||2.5,this.throttle="throttle"in a?a.throttle:16,this.minDistance="minDistance"in a?a.minDistance:5,this._strokeMoveUpdate=this.throttle?function(t,n,i){var a,o,d,h=null,c=0;i||(i={});var l=function(){c=!1===i.leading?0:Date.now(),h=null,d=t.apply(a,o),h||(a=o=null)};return function(){var s=Date.now();!c&&!1===i.leading&&(c=s);var u=n-(s-c);return a=this,o=arguments,u<=0||u>n?(h&&(clearTimeout(h),h=null),c=s,d=t.apply(a,o),h||(a=o=null)):!h&&!1!==i.trailing&&(h=setTimeout(l,u)),d}}(r.prototype._strokeUpdate,this.throttle):r.prototype._strokeUpdate,this.dotSize=a.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=a.penColor||"black",this.backgroundColor=a.backgroundColor||"rgba(0,0,0,0)",this.onBegin=a.onBegin,this.onEnd=a.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(o){1===o.which&&(i._mouseButtonDown=!0,i._strokeBegin(o))},this._handleMouseMove=function(o){i._mouseButtonDown&&i._strokeMoveUpdate(o)},this._handleMouseUp=function(o){1===o.which&&i._mouseButtonDown&&(i._mouseButtonDown=!1,i._strokeEnd(o))},this._handleTouchStart=function(o){1===o.targetTouches.length&&i._strokeBegin(o.changedTouches[0])},this._handleTouchMove=function(o){o.preventDefault(),i._strokeMoveUpdate(o.targetTouches[0])},this._handleTouchEnd=function(o){o.target===i._canvas&&(o.preventDefault(),i._strokeEnd(o))},this.on()}p.d(w,{Z:()=>v}),g.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},g.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},g.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},y.prototype.length=function(){for(var n=0,i=void 0,a=void 0,o=0;o<=10;o+=1){var d=o/10,h=this._point(d,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),c=this._point(d,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(o>0){var l=h-i,s=c-a;n+=Math.sqrt(l*l+s*s)}i=h,a=c}return n},y.prototype._point=function(t,n,i,a,o){return n*(1-t)*(1-t)*(1-t)+3*i*(1-t)*(1-t)*t+3*a*(1-t)*t*t+o*t*t*t},r.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,n.width,n.height),t.fillRect(0,0,n.width,n.height),this._data=[],this._reset(),this._isEmpty=!0},r.prototype.fromDataURL=function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new Image,o=i.ratio||window.devicePixelRatio||1,d=i.width||this._canvas.width/o,h=i.height||this._canvas.height/o;this._reset(),a.src=t,a.onload=function(){n._ctx.drawImage(a,0,0,d,h)},this._isEmpty=!1},r.prototype.toDataURL=function(t){var n;switch(t){case"image/svg+xml":return this._toSVG();default:for(var i=arguments.length,a=Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return(n=this._canvas).toDataURL.apply(n,[t].concat(a))}},r.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},r.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},r.prototype.isEmpty=function(){return this._isEmpty},r.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},r.prototype._strokeUpdate=function(t){var a=this._createPoint(t.clientX,t.clientY),o=this._data[this._data.length-1],d=o&&o[o.length-1],h=d&&a.distanceTo(d)<this.minDistance;if(!d||!h){var c=this._addPoint(a),l=c.curve,s=c.widths;l&&s&&this._drawCurve(l,s.start,s.end),this._data[this._data.length-1].push({x:a.x,y:a.y,time:a.time,color:this.penColor})}},r.prototype._strokeEnd=function(t){var i=this.points[0];if(!(this.points.length>2)&&i&&this._drawDot(i),i){var a=this._data[this._data.length-1];i.equals(a[a.length-1])||a.push({x:i.x,y:i.y,time:i.time,color:this.penColor})}"function"==typeof this.onEnd&&this.onEnd(t)},r.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},r.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},r.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},r.prototype._createPoint=function(t,n,i){var a=this._canvas.getBoundingClientRect();return new g(t-a.left,n-a.top,i||(new Date).getTime())},r.prototype._addPoint=function(t){var n=this.points,i=void 0;if(n.push(t),n.length>2){3===n.length&&n.unshift(n[0]);var a=(i=this._calculateCurveControlPoints(n[0],n[1],n[2])).c2;i=this._calculateCurveControlPoints(n[1],n[2],n[3]);var d=new y(n[1],a,i.c1,n[2]),h=this._calculateCurveWidths(d);return n.shift(),{curve:d,widths:h}}return{}},r.prototype._calculateCurveControlPoints=function(t,n,i){var a=t.x-n.x,o=t.y-n.y,d=n.x-i.x,h=n.y-i.y,c_x=(t.x+n.x)/2,c_y=(t.y+n.y)/2,l_x=(n.x+i.x)/2,l_y=(n.y+i.y)/2,s=Math.sqrt(a*a+o*o),u=Math.sqrt(d*d+h*h),x=u/(s+u),S=n.x-(l_x+(c_x-l_x)*x),M=n.y-(l_y+(c_y-l_y)*x);return{c1:new g(c_x+S,c_y+M),c2:new g(l_x+S,l_y+M)}},r.prototype._calculateCurveWidths=function(t){var a={start:null,end:null},o=this.velocityFilterWeight*t.endPoint.velocityFrom(t.startPoint)+(1-this.velocityFilterWeight)*this._lastVelocity,d=this._strokeWidth(o);return a.start=this._lastWidth,a.end=d,this._lastVelocity=o,this._lastWidth=d,a},r.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},r.prototype._drawPoint=function(t,n,i){var a=this._ctx;a.moveTo(t,n),a.arc(t,n,i,0,2*Math.PI,!1),this._isEmpty=!1},r.prototype._drawCurve=function(t,n,i){var a=this._ctx,o=i-n,d=Math.floor(t.length());a.beginPath();for(var h=0;h<d;h+=1){var c=h/d,l=c*c,s=l*c,u=1-c,m=u*u,E=m*u,x=E*t.startPoint.x;x+=3*m*c*t.control1.x,x+=3*u*l*t.control2.x;var _=E*t.startPoint.y;_+=3*m*c*t.control1.y,_+=3*u*l*t.control2.y,this._drawPoint(x+=s*t.endPoint.x,_+=s*t.endPoint.y,n+s*o)}a.closePath(),a.fill()},r.prototype._drawDot=function(t){var n=this._ctx,i="function"==typeof this.dotSize?this.dotSize():this.dotSize;n.beginPath(),this._drawPoint(t.x,t.y,i),n.closePath(),n.fill()},r.prototype._fromData=function(t,n,i){for(var a=0;a<t.length;a+=1){var o=t[a];if(o.length>1)for(var d=0;d<o.length;d+=1){var h=o[d],c=new g(h.x,h.y,h.time),l=h.color;if(0===d)this.penColor=l,this._reset(),this._addPoint(c);else if(d!==o.length-1){var s=this._addPoint(c),u=s.curve,m=s.widths;u&&m&&n(u,m,l)}}else this._reset(),i(o[0])}},r.prototype._toSVG=function(){var t=this,n=this._data,i=this._canvas,a=Math.max(window.devicePixelRatio||1,1),h=i.width/a,c=i.height/a,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttributeNS(null,"width",i.width),l.setAttributeNS(null,"height",i.height),this._fromData(n,function(f,P,k){var C=document.createElement("path");if(!(isNaN(f.control1.x)||isNaN(f.control1.y)||isNaN(f.control2.x)||isNaN(f.control2.y))){var T="M "+f.startPoint.x.toFixed(3)+","+f.startPoint.y.toFixed(3)+" C "+f.control1.x.toFixed(3)+","+f.control1.y.toFixed(3)+" "+f.control2.x.toFixed(3)+","+f.control2.y.toFixed(3)+" "+f.endPoint.x.toFixed(3)+","+f.endPoint.y.toFixed(3);C.setAttribute("d",T),C.setAttribute("stroke-width",(2.25*P.end).toFixed(3)),C.setAttribute("stroke",k),C.setAttribute("fill","none"),C.setAttribute("stroke-linecap","round"),l.appendChild(C)}},function(f){var P=document.createElement("circle"),k="function"==typeof t.dotSize?t.dotSize():t.dotSize;P.setAttribute("r",k),P.setAttribute("cx",f.x),P.setAttribute("cy",f.y),P.setAttribute("fill",f.color),l.appendChild(P)});var u='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+h+" "+c+'" width="'+h+'" height="'+c+'">',m=l.innerHTML;if(void 0===m){var E=document.createElement("dummy"),x=l.childNodes;E.innerHTML="";for(var _=0;_<x.length;_+=1)E.appendChild(x[_].cloneNode(!0));m=E.innerHTML}return"data:image/svg+xml;base64,"+btoa(u+m+"</svg>")},r.prototype.fromData=function(t){var n=this;this.clear(),this._fromData(t,function(i,a){return n._drawCurve(i,a.start,a.end)},function(i){return n._drawDot(i)}),this._data=t},r.prototype.toData=function(){return this._data};const v=r}}]);